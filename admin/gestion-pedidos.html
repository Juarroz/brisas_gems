<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Gestion Pedidos</title>
    <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/assets/css-global/main.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="../css/mis-pedidos.css">
</head>
<body>

<!-- ---- -->
<!--HEADER-->
<!-- ---- -->

<header class="encabezado">
  <div class="contenedor-header">

    <!-- Logo centrado -->
    <div class="logo-centro">
        <img src="../img/logo.png" alt="Logo Brisas Gems">
      </a>
    </div>

    <!-- Men칰 izquierdo -->
    <nav class="nav-izquierda">
      <a href="./gestion-usuarios-1.html">GESTI칍N USUARIO</a>
      <a href="./gestion-inspiracion.html">GESTI칍N INSPIRACI칍N</a>
      <a href="./gestion-opciones.html">GESTI칍N PERSONALIZACI칍N</a>
      <a href="./gestion-pedidos.html">GESTI칍N PEDIDOS</a>
    </nav>


    <!-- 칈conos a la derecha -->
    <div class="menu-derecha">
      <div class="perfil-wrapper">
        <img src="../img/person.svg" alt="Perfil" class="icono" id="icono-usuario">
        <div class="menu-usuario" id="menu-usuario">
          <a href="#">Mi Perfil</a>
          <a href="../index.html">Cerrar Sesion</a>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- admin/gestion-pedido-detalle.html -->
<!-- Asume que este fragmento se incluye entre header.php y footer.php -->
<div class="container my-5">

  <!-- 1. Secci칩n: Subir dise침o renderizado (RF 0023) -->
  <section id="render-upload" class="mb-5">
    <h2 class="h4 mb-3">1. Subir dise침o 3D renderizado</h2>
    <form id="form-render" action="../php/upload_render.php" method="post" enctype="multipart/form-data">
      <input type="hidden" name="ped_id" value="<?= $_GET['ped_id'] ?>">
      <div class="mb-3">
        <label for="file-render" class="form-label">Archivo 3D (.obj, .stl)</label>
        <input class="form-control" type="file" id="file-render" name="render_file"
               accept=".obj,.stl" required>
      </div>
      <button type="submit" class="btn btn-primary">Subir render</button>
      <div id="render-feedback" class="form-text text-danger mt-2"></div>
    </form>
    <!-- Preview del modelo 3D -->
    <div class="mt-4">
      <model-viewer id="preview-render" 
                    style="width:100%;height:400px;" 
                    camera-controls 
                    ar 
                    src="">
      </model-viewer>
    </div>
  </section>

  <!-- 2. Secci칩n: Subir imagen del producto terminado (RF 0024) -->
  <section id="foto-final" class="mb-5">
    <h2 class="h4 mb-3">2. Subir foto producto terminado</h2>
    <form id="form-foto" action="../php/upload_final_photo.php" method="post" enctype="multipart/form-data">
      <input type="hidden" name="ped_id" value="<?= $_GET['ped_id'] ?>">
      <div class="mb-3">
        <label for="file-photo" class="form-label">Imagen (JPG, PNG)</label>
        <input class="form-control" type="file" id="file-photo" name="photo_file"
               accept=".jpg,.jpeg,.png" required>
      </div>
      <button type="submit" class="btn btn-primary">Subir imagen final</button>
      <div id="photo-feedback" class="form-text text-danger mt-2"></div>
    </form>
  </section>

  <!-- 3. Secci칩n: Agregar comentarios al pedido (RF 0025) -->
  <section id="comentarios" class="mb-5">
    <h2 class="h4 mb-3">3. Comentarios y notas</h2>
    <form id="form-comentario" action="../php/update_pedido_comments.php" method="post">
      <input type="hidden" name="ped_id" value="<?= $_GET['ped_id'] ?>">
      <div class="mb-3">
        <label for="input-comentario" class="form-label">Observaciones</label>
        <textarea class="form-control" id="input-comentario" name="comentario"
                  rows="3" placeholder="Escribe aqu칤 tus notas..." required><?= $pedido['ped_comentarios'] ?></textarea>
      </div>
      <button type="submit" class="btn btn-secondary">Guardar comentario</button>
    </form>
  </section>

  <!-- 4. Secci칩n: Historial de pedidos trabajados (RF 0026) -->
  <section id="historial" class="mb-5">
    <h2 class="h4 mb-3">4. Historial de pedidos en trabajo</h2>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>C칩digo</th>
          <th>Fecha</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <?php foreach($historial as $h): ?>
        <tr>
          <td><?= $h['ped_codigo'] ?></td>
          <td><?= $h['ped_fecha_creacion'] ?></td>
          <td><?= $h['est_nombre'] ?></td>
          <td>
            <a href="gestion-pedido-detalle.html?ped_id=<?= $h['ped_id'] ?>"
               class="btn btn-sm btn-outline-primary">Ver detalle</a>
          </td>
        </tr>
        <?php endforeach; ?>
      </tbody>
    </table>
  </section>

  <!-- 5. Secci칩n: Actualizar barra de progreso (RF 0027) -->
  <section id="progreso" class="mb-5">
    <h2 class="h4 mb-3">5. Actualizar estado y progreso</h2>
    <form id="form-estado" action="../php/update_pedido_status.php" method="post" class="mb-3">
      <input type="hidden" name="ped_id" value="<?= $_GET['ped_id'] ?>">
      <div class="row g-3 align-items-center">
        <div class="col-auto">
          <label for="select-estado" class="col-form-label">Estado:</label>
        </div>
        <div class="col-auto">
          <select id="select-estado" name="est_id" class="form-select" required>
            <?php foreach($estados as $e): ?>
            <option value="<?= $e['est_id'] ?>" <?= $pedido['est_id']==$e['est_id']?'selected':''?>>
              <?= $e['est_nombre'] ?>
            </option>
            <?php endforeach; ?>
          </select>
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-success">Actualizar</button>
        </div>
      </div>
    </form>
    <!-- Barra de progreso Bootstrap 
    <div class="progress" style="height: 1.5rem;">
      <div id="barra-progreso" class="progress-bar" role="progressbar"
           style="width: <?= $pedido['est_id']*25 ?>%;" aria-valuenow="<?= $pedido['est_id']*25 ?>"  -->
           aria-valuemin="0" aria-valuemax="100">
        <?= $pedido['est_id']*25 ?>%
      </div>
    </div>
  </section>

</div>



    <!-- Footer existente -->
       <!-- ------ -->
  <!-- FOOTER -->
  <!-- ------ -->

  <footer class="footer-joyeria text-start">
    <div class="contenedor-footer">
      
      <div class="columna-footer">
        <h4>Brisas Gems</h4>
        <p>游릭 Joyer칤a fina y personalizada con los m치s altos est치ndares de calidad.</p>
        <div class="redes-sociales">
          <a href="#" target="_blank" rel="noopener" aria-label="Facebook Brisas Gems">
            <img src="../img/icono-whatsApp.png" alt="Facebook Brisas Gems">
          </a>
          <a href="#" target="_blank" rel="noopener" aria-label="Instagram Brisas Gems">
            <img src="../img/icono instagram.png" alt="Instagram Brisas Gems">
          </a>
          <a href="#" target="_blank" rel="noopener" aria-label="WhatsApp Brisas Gems">
            <img src="../img/icono-facebook.png" alt="WhatsApp Brisas Gems">
          </a>
        </div>
      </div>
  
      <div class="columna-footer">
        <h4>Contacto</h4>
        <p><span class="icono-footer">游릭</span> Av Jim칠nez #5-43, Emerald Trade Center, Bogot치</p>
        <p><span class="icono-footer">游릭</span> +57 6017654312</p>
        <p><span class="icono-footer">游릭</span> info@brisasgem.com</p>
      </div>
  
      <div class="columna-footer">
        <h4>Enlaces</h4>
        <nav aria-label="Enlaces r치pidos">
          <ul class="enlaces-footer">
            <li><a href="./index.html"> Inicio</a></li>
            <li><a href="./personalizar.html"> Personalizaci칩n</a></li>
            <li><a href="./inspiracion.html"> Inspiraci칩n</a></li>
          </ul>
        </nav>
      </div>
  
    </div>
  
    <div class="derechos-footer">
      <p>춸 2025 Brisas Gems - Todos los derechos reservados</p>
      <p>Desarrollado por SENA CEET - Ficha 2996176 ADSO</p>
    </div>
  </footer>
  <!-- Model Viewer script necesario para previsualizar .obj/.stl -->
<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
<script src="../js/gestion-pedidos.js"></script>
</body>
</html>
